kind: ConfigMap
apiVersion: v1
metadata:
  name: init-scripts
data:
  init-minio.sh: |-
    #!/usr/bin/env sh
    # Create bucket
    mc alias set minio ${MINIO_ENDPOINT} ${MINIO_ROOT_USER} ${MINIO_ROOT_PASSWORD}
    if [ $? -gt 0 ]; then exit 1; fi
    echo "Creating buckets on minio alias ..."
    mc mb minio/rhods
    mc mb minio/images
    mc mb minio/mlflow
    curl -LJ ${MNIST_DATASET} -o /tmp/dataset.tar.gz
    mkdir /tmp/dataset
    tar xzf /tmp/dataset.tar.gz -C /tmp/dataset --strip-components 1
    unzip /tmp/dataset/digit-recognizer.zip -d /tmp/dataset
    mc cp /tmp/dataset/train.csv minio/rhods/data/train.csv
    mc cp /tmp/dataset/test.csv minio/rhods/data/test.csv
    echo "Creation completed"
  push-model.sh: |-
    #!/usr/bin/env sh
    # Push to bucket
    mc alias set minio ${MINIO_ENDPOINT} ${MINIO_ROOT_USER} ${MINIO_ROOT_PASSWORD}
    mc mb minio/rhods
    set -e
    curl -LJ ${NOTEBOOKS_GIT_URL}/tarball/main -o /tmp/model.tar.gz
    mkdir /tmp/model
    tar xzf /tmp/model.tar.gz -C /tmp/model --strip-components 1
    mc cp /tmp/model/models/model-v2.onnx minio/rhods/onnx/model-v2.onnx
    mc cp /tmp/model/models/model-v2.onnx minio/rhods/onnx/model-prod.onnx
    echo "Model pushed into bucket"