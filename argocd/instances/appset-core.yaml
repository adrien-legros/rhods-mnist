apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: rhods-mnist-core
  namespace: openshift-gitops
spec:
  generators:
  - list:
      elements:
      - component: ./operators/core/
        name: operators
      # - component: ./manifests/knative-instance/
      #   name: serverless-instanciation
      - component: ./manifests/project/
        name: data-science-project-base
      # - component: ./manifests/notebook-images/
      #   name: notebook-images
      - component: ./manifests/ds-pipelines/
        name: data-science-pipelines
      - component: ./manifests/openshift-pipelines/
        name: openshift-pipelines
      # - component: ./inference/
      #   name: inference
      # - component: ./lab/solve/
      #   name: notebooks-and-serving
  template:
    metadata:
      name: 'core-{{name}}'
    spec:
      project: default
      source:
        repoURL: https://github.com/adrien-legros/rhods-mnist
        targetRevision: v3
        path: '{{component}}'
        directory:
          recurse: false
      destination:
        server: https://kubernetes.default.svc
      syncPolicy:        
        syncOptions:
        - CreateNamespace=false
        automated:
          selfHeal: false
          prune: true
        managedNamespaceMetadata:
          labels:
            argocd.argoproj.io/managed-by: openshift-gitops